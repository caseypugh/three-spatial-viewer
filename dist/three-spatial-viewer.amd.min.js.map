{"version":3,"file":"three-spatial-viewer.amd.min.js","sources":["../src/components/constants.ts","../src/components/uniforms.ts","../src/components/player.ts"],"sourcesContent":["enum SpatialType {\n  // MONO = 0,\n  // STEREO = 1,\n  LOOKING_GLASS\n}\n\nenum StereoMode {\n  OFF,\n  COLOR ,\n  RED_CYAN,\n  DIFFERENCE,\n  LEFT_RIGHT,\n}\n\nclass QuiltConfig {\n  public angle: number = 0\n  public stereoEyeDistance: number = 8\n  public rows: number = 8\n  public columns: number = 8\n  public width: number = 480\n  public height: number = 640\n}\n\nclass Props {\n  public spatialType: SpatialType = SpatialType.LOOKING_GLASS\n  public quilt: QuiltConfig = null\n  public stereoMode: StereoMode = StereoMode.COLOR\n}\n\nexport { QuiltConfig, SpatialType, StereoMode, Props }","export const Uniforms = {\n  colorTexture: {\n    value: null\n  },\n  quiltRows: {\n    value: 0,\n  },\n  quiltColumns: {\n    value: 0,\n  },\n  quiltViewWidth: {\n    value: 0,\n  },\n  quiltViewHeight: {\n    value: 0,\n  },\n  quiltAngle: {\n    value: 0,\n  },\n  quiltStereoEyeDistance: {\n    value: 0,\n  },\n}\n","import {\n  Object3D,\n  ShaderMaterial,\n  Mesh,\n  PlaneBufferGeometry,\n  Texture,\n  RGBFormat,\n  FrontSide,\n  RepeatWrapping\n} from './three'\n\n// @ts-ignore\nimport frag from '../shaders/spatial.frag'\n// @ts-ignore\nimport vert from '../shaders/spatial.vert'\n\nimport { Uniforms } from './uniforms'\nimport { Props, QuiltConfig, SpatialType, StereoMode } from './constants'\n\nexport default class Player extends Object3D {\n\n  private props: Props = new Props()\n\n  private static geometry: PlaneBufferGeometry\n\n  private material: ShaderMaterial = new ShaderMaterial({\n    uniforms: Uniforms,\n    vertexShader: vert,\n    fragmentShader: frag,\n    transparent: true,\n    side: FrontSide,\n  })\n\n  constructor(texture: Texture, depth?: Texture, props?: Props) {\n    super()\n\n    /** Assign the user provided props, if any */\n    this.setProps(this.props, props)\n\n    /** Add the compiler definitions needed to pick the right GLSL methods */\n    this.setShaderDefines(this.shaderDefines)\n\n    /**\n     * Create the geometry only once, it can be shared between instances\n     *  of the viewer since it's kept as a static class member\n     **/\n    if (!Player.geometry) {\n      Player.geometry = new PlaneBufferGeometry(1, 1)\n      // Player.geometry.scale(this.aspectRatio, 1, 1);\n      this.scale.x = this.aspectRatio\n    }\n\n    /** Assign the textures and update the shader uniforms */\n    this.assignTexture(texture)\n    this.updateUniforms()\n\n    /** Create the Mesh/Points and add it to the viewer object */\n    super.add(this.createMesh(Player.geometry, this.material))\n  }\n\n  private createMesh(geo: PlaneBufferGeometry, mat: ShaderMaterial): Mesh {\n    return new Mesh(geo, mat);\n  }\n\n  /** Internal util to assign the textures to the shader uniforms */\n  private assignTexture(tex: Texture): void {\n    this.texture = this.setDefaultTextureProps(tex)\n  }\n\n  private clearDefines(defines: Array<string>): void {\n    defines.forEach(define => {\n      delete this.material.defines[define]\n    })\n    this.material.needsUpdate = true\n  }\n\n  private setShaderDefines(defines: Array<string>): void {\n    defines.forEach(define => {\n      if (define) {\n        this.material.defines[define] = ''\n      }\n    })\n    this.material.needsUpdate = true\n  }\n\n  /** Internal util to set viewer props from config object */\n  private setProps(viewerProps: Props, userProps?: object): void {\n    if (!userProps) return\n\n    /** Iterate over user provided props and assign to viewer props */\n    for (let prop in userProps) {\n      if (prop in viewerProps) {\n        viewerProps[prop] = userProps[prop]\n      } else {\n        console.warn(\n          `SpatialViewer: Provided ${prop} in config but it is not a valid property and wiill be ignored`,\n        )\n      }\n    }\n  }\n\n  private setDefaultTextureProps(texture: Texture): Texture {\n    texture.format = RGBFormat\n    texture.generateMipmaps = true\n    texture.wrapS = RepeatWrapping\n    texture.wrapT = RepeatWrapping\n    return texture\n  }\n\n  private updateUniforms() {\n    this.material.uniforms.quiltStereoEyeDistance.value = this.props.quilt.stereoEyeDistance\n    this.material.uniforms.quiltAngle.value = this.props.quilt.angle\n    this.material.uniforms.quiltColumns.value = this.props.quilt.columns\n    this.material.uniforms.quiltRows.value = this.props.quilt.rows\n  }\n\n  public dispose(): void {\n    if (this.material) { \n      Player.geometry.dispose()\n      this.material.dispose()\n      this.texture.dispose()\n    }\n  }\n\n  public get shaderDefines(): Array<string> {\n    return [SpatialType[this.props.spatialType], \n            \"STEREO_\" + StereoMode[this.props.stereoMode],\n            this.props.stereoMode == StereoMode.OFF ? null : \"STEREO_ON\" ]\n  }\n\n  public get spatial(): SpatialType {\n    return this.props.spatialType\n  }\n\n  public set spatial(val: SpatialType) {\n    this.clearDefines(this.shaderDefines)\n    this.props.spatialType = val\n    this.setShaderDefines(this.shaderDefines)\n  }\n\n  public get stereoMode(): StereoMode {\n    return this.props.stereoMode\n  }\n\n  public set stereoMode(val: StereoMode) {\n    this.clearDefines(this.shaderDefines)\n    this.props.stereoMode = val\n    this.setShaderDefines(this.shaderDefines)\n    this.scale.set(this.aspectRatio, 1, 1)\n  }\n\n  public get aspectRatio(): number {\n    if (this.props.stereoMode == StereoMode.LEFT_RIGHT) {\n      return (this.props.quilt.width * 2.0) / this.props.quilt.height\n    }\n    \n    return this.props.quilt.width / this.props.quilt.height\n  }\n\n  public get quiltAngle(): number {\n    return this.props.quilt.angle\n  }\n\n  public set quiltAngle(val: number) {\n    this.props.quilt.angle = val\n    this.updateUniforms()\n  }\n\n  public get quiltStereoEyeDistance(): number {\n    return this.props.quilt.stereoEyeDistance\n  }\n\n  public set quiltStereoEyeDistance(val: number) {\n    this.props.quilt.stereoEyeDistance = val\n    this.updateUniforms()\n  }\n\n  public get quiltWidth(): number {\n    return this.props.quilt.width\n  }\n\n  public set quiltWidth(val: number) {\n    this.props.quilt.width = val\n    this.updateUniforms()\n  }\n\n  public set quiltHeight(val: number) {\n    this.props.quilt.height = val\n    this.updateUniforms()\n  }\n\n  public get quiltHeight(): number {\n    return this.props.quilt.height\n  }\n\n  public set quiltRows(val: number) {\n    this.props.quilt.rows = val\n    this.updateUniforms()\n  }\n\n  public get quiltRows(): number {\n    return this.props.quilt.rows\n  }\n\n  public set quiltColumns(val: number) {\n    this.props.quilt.columns = val\n    this.updateUniforms()\n  }\n\n  public get quiltColumns(): number {\n    return this.props.quilt.columns\n  }\n\n  public set texture(map: Texture) {\n    this.material.uniforms.colorTexture.value = map\n  }\n\n  public get texture(): Texture {\n    return this.material.uniforms.colorTexture.value\n  }\n\n}\n"],"names":["SpatialType","StereoMode","Uniforms","colorTexture","value","quiltRows","quiltColumns","quiltViewWidth","quiltViewHeight","quiltAngle","quiltStereoEyeDistance","Props","[object Object]","this","spatialType","LOOKING_GLASS","quilt","stereoMode","COLOR","Player","Object3D","constructor","texture","depth","props","super","material","ShaderMaterial","uniforms","vertexShader","fragmentShader","transparent","side","FrontSide","setProps","setShaderDefines","shaderDefines","geometry","PlaneBufferGeometry","scale","x","aspectRatio","assignTexture","updateUniforms","add","createMesh","geo","mat","Mesh","tex","setDefaultTextureProps","clearDefines","defines","_this","forEach","define","needsUpdate","_this2","viewerProps","userProps","prop","console","warn","concat","format","RGBFormat","generateMipmaps","wrapS","RepeatWrapping","wrapT","stereoEyeDistance","angle","columns","rows","dispose","OFF","spatial","val","set","LEFT_RIGHT","width","height","quiltWidth","quiltHeight","map"],"mappings":"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"}